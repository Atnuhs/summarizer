# Go 競技プログラミング用バンドルツール仕様書

## 概要

AtCoder などの競技プログラミングサイトに提出するために、複数の Go ファイル・パッケージを 1 つのファイルにまとめるツールを開発する。

## 背景と課題

- AtCoder では 1 ファイルでの提出が必要
- 自作ライブラリを機能別パッケージに分けて管理したい
- 既存の bundle ツールは単一パッケージしか扱えない
- import 階層をフラット化する標準的なツールが存在しない

## 主要機能

1. **依存関係解析**: main.go からインポートされているパッケージを検出
2. **コールグラフ解析**: 実際に使用されているコードのみを抽出（デッドコード除去）
3. **コード統合**: 複数パッケージを 1 つの main パッケージに統合
4. **名前衝突回避**: パッケージ名をプレフィックスとして付与
5. **init 関数統合**: 複数の init 関数を 1 つに集約

## 技術仕様

### コマンドラインインターフェース

```bash
your-tool -input main.go -output submit.go
```

### 処理フロー

1. main.go を解析し、標準ライブラリ以外の依存関係を検出
2. 各依存パッケージのコードを読み込み
3. コールグラフ解析により使用されているコードを特定
4. 名前衝突を避けるため、型・関数名にパッケージ名プレフィックスを付与
5. 複数の init 関数を 1 つに統合
6. すべてのコードを 1 つのファイルに出力

### 出力形式

- ファイル先頭に `// Code generated by your-tool; DO NOT EDIT.` を挿入
- package main 宣言
- 必要な標準ライブラリの import 文
- 統合されたコード（元パッケージ情報をコメントで保持）

### エラー処理

- プレフィックス付与後も名前が衝突する場合はエラー終了
- シンプルなエラーメッセージを表示

### 進行状況表示

```
Analyzing main.go...
Found 3 dependencies: unionfind, graph, math
Processing unionfind package...
Processing graph package...
Processing math package...
Removing unused code...
Merging init functions...
Writing to submit.go...
Done!
```

## 開発方針

**シンプルさを最優先**

- 読みやすいコード
- バグの少ない実装
- 行数を最小限に
- 説明しやすい設計
- 理解しやすい処理フロー
- 持ち込む概念を最小限に

## 実装における推奨事項

- 既存ツール（golang.org/x/tools/cmd/bundle、go/analysis 等）を活用
- 過度に複雑な機能は避ける
- 必要最小限の機能に絞る

## 除外事項

- \_test.go ファイルは処理対象外
- ビルドタグは考慮しない（事前に処理済みと仮定）
- 設定ファイルは不要（シンプルさ優先）

## 想定される使用例

現在の構成：

```
go-acl/
├── unionfind/
│   └── unionfind.go
├── graph/
│   └── graph.go
├── math/
│   └── math.go
└── cmd/
    └── main.go
```

main.go:

```go
package main

import (
    "go-acl/unionfind"
    "go-acl/graph"
)

func main() {
    uf := unionfind.New(10)
    g := graph.New()
    // ...
}
```

実行：

```bash
your-tool -input cmd/main.go -output submit.go
```

生成される submit.go:

```go
// Code generated by your-tool; DO NOT EDIT.
package main

// From package unionfind
type unionfind_UnionFind struct { ... }
func unionfind_New(n int) *unionfind_UnionFind { ... }

// From package graph
type graph_Graph struct { ... }
func graph_New() *graph_Graph { ... }

func init() {
    // Merged init functions
}

func main() {
    uf := unionfind_New(10)
    g := graph_New()
    // ...
}
```
